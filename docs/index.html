<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Software Update Tool: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.ico"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Software Update Tool
   &#160;<span id="projectnumber">Beta 2.1.0</span>
   </div>
   <div id="projectbrief">Tool that updates the Software of the smart-sync device.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Software Update Tool Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md0"></a>
SW Update Tool - Development</h1>
<p>Here is being developed the new C# Software Updating Tool for the smart-sync device.</p>
<p>The files to be flashed at the development project should be under "..\P01_SW_Updt\p01-sw-software-update\CS_Updt_Tool\SwUpdate\SwUpdtTests\bin\Debug\net5.0\data\" At the published p01-update.exe file, the flashing files should be placed under a folder named "data", that must be at the same location as the p01-update.exe.</p>
<p>Please run the doxygen configuration to get the html output under the Doc/Doxygen/Configuration for a better understanding of the developed code. <a href="https://www.doxygen.nl/download.html">Download doxygen</a>.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
How to use</h2>
<p>During the update, ignore warnings that might appear on the Sensor Box display.</p>
<h3><a class="anchor" id="autotoc_md2"></a>
Remote Update</h3>
<p>(p01-update-VER.exe) (only works to update a fully functional device)</p>
<p>To update the hole device, please follow the instructions:</p><ol type="1">
<li>Connect the device intended to be updated to the computer with the Programming Cable.</li>
<li>Turn off the device and wait for 10 seconds.</li>
<li>Make sure the cable is properly connected.</li>
<li>Turn on the device.</li>
<li>Execute the Version Update Tool (Double-click on executable provided in zip-file).and select “yes”.</li>
<li>If updating the Sensor Box, ignore the warning on the display.</li>
<li>If asked, provide the device type by typing “0” for the Sensor Box, “1” for the Connector Box.</li>
<li>Wait until the update has concluded successfully and confirm by pressing enter to close the program.</li>
<li>Update is completed.</li>
<li>For more information regarding the performed update, consult the log file "p01-update-VER.log" at the Desktop folder.</li>
</ol>
<h3><a class="anchor" id="autotoc_md3"></a>
Generic use with inputs</h3>
<p>This way the tool can update the software of the device with the binaries the user choses, independently of the current version on the device:</p>
<ol type="1">
<li>Connect the device intended to be updated to the computer with the Programming Cable.</li>
<li>Turn off the device and wait for 10 seconds.</li>
<li>Make sure the cable is properly connected.</li>
<li>Turn on the device. 5.Open a terminal window (command line) and type one of the following options:</li>
</ol>
<p>(The optional parameters "-sw MCU "indicates the part of the device to be updated, "-p PATH" indicates the path of the folder with the binaries)</p>
<ul>
<li>"p01-update.exe -p PATH", similar to the remote update with the binaries from the folder in "PATH".</li>
<li>"p01-update.exe -sw WCS -p PATH", updates the Wireless firmware.</li>
<li>"p01-update.exe -sw ALL -p PATH", updates all the firmware of the device.</li>
<li>"p01-update.exe -sw UIS -p PATH", updates the user interface firmware.</li>
<li>"p01-update.exe -sw CBS -p PATH, updates the Connector Box firmware.</li>
<li>"p01-update.exe -sw SBS -p PATH", updates the Sensor Box Firmware.</li>
</ul>
<p>If updating the Sensor Box, ignore the warning on the display.</p><ol type="1">
<li>If asked, provide the device type by typing “0” for the Sensor Box, “1” for the Connector Box.</li>
<li>Wait until the update has concluded successfully and confirm by pressing enter to close the program.</li>
<li>Update is completed.</li>
<li>For more information regarding the performed update, consult the log file "p01-update-VER.log" at the Desktop folder.</li>
</ol>
<h2><a class="anchor" id="autotoc_md4"></a>
Current Features</h2>
<ul>
<li>Communicate through Serial Port (with auto detection of our FTDI in Windows);</li>
<li>Configure Serial port and UART pins;</li>
<li>Update the SMT32H7 firmware;</li>
<li>Update the NRF52 firmware;</li>
<li>Update the Atmel firmware (sometimes fails due to bug on library from Cognimed - fix ongoing);</li>
<li>Update all the firmware on a row (with auto detection of the binary files option).</li>
</ul>
<h2><a class="anchor" id="autotoc_md5"></a>
Building on Windows:</h2>
<p>Within the project folder "MainProject" run on the Terminal "dotnet publish -r win7-x64 -p:PublishSingleFile=true -o dist/ --self-contained true p01-update.csproj"</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Building on macOS Computer:</h2>
<p>Within the project folder "MainProject" run on the Terminal "dotnet publish -r osx-x64 -p:PublishSingleFile=true -o dist/ --self-contained true p01-update.csproj"</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Building the Client's executable</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
On Windows</h3>
<p>Read the instructions under .\Modules\ClientExecutable and run the build_client_exe.bat file.</p>
<p>Alternatively, follow the instructions below: (Based on the generic instructions (<a href="https://ntsblog.homedev.com.au/index.php/2015/05/14/self-extracting-archive-runs-setup-exe-7zip-sfx-switch/">link</a>))</p>
<ol type="1">
<li>To make this easy create a folder c:\Install. This is where we will copy all the required files.</li>
<li>Go to the folder that has the data folder with the binaries and the p01-update.exe Select both the .msi and the setup.exe Right-Click and choose 7Zip --&gt; "Add to Archive" Name the archive "p01-update-VER.7z" Click Ok Copy this .7z file to your c:\Install directory</li>
<li>Get the 7z-Extra sfx extension module (7zSD.sfx, also available at the \Modules\ClientExecutable\cfg folder) Copy the file "7zSD.sfx" to c:\Install</li>
<li><p class="startli">Setup the config.txt It is recommend to use NotePad++ to edit this text file as it will need to be encoded in UTF-8. The following instructions are using notepad++. Right-click and choose "Edit with NotePad++
    Click the "Encoding Menu" and choose "Encode in UTF-8" Enter something like this:</p>
<p class="startli">;!@Install@!UTF-8!</p>
<p class="startli">Title="p01-update-VER"</p>
<p class="startli">BeginPrompt="Do you want to install p01-update-VER?"</p>
<p class="startli">RunProgram="p01-update-VER.exe"</p>
<p class="startli">;!@InstallEnd@!</p>
<p class="startli">Edit this replacing [p01-update-VER] with the product name. Notes on the parameters and options for the setup file are here.</p>
</li>
</ol>
<p>CheckPoint There should now be a folder "c:\Install" with the following 3 files: </p><pre class="fragment">p01-update-VER.7z

7zSD.sfx

config.txt
</pre><ol type="1">
<li><p class="startli">Create the archive</p>
<p class="startli">Open a cmd window, Window + R --&gt; cmd --&gt; press enter</p>
<p class="startli">In the command window type the following </p><pre class="fragment">cd \

cd Install

copy /b 7zSD.sfx + config.txt + p01-update-VER.7z p01-update-VER.exe
</pre><p> Look in c:\Install and you will now see there is a p01-updater-VER.exe</p>
</li>
</ol>
<p>You are finished</p>
<p>Run the installer</p>
<p>Double click on p01-updater-VER.exe and it will prompt with the configured message. Click OK and the p01-updater-VER.exe will run.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md10"></a>
Console Application</h2>
<p><code><a class="el" href="_program_8cs.html">Program.cs</a></code></p>
<p>Executes the code that updates the full device and feedbacks the state during the update. Current inputs can be the Com Port name, the device type and the flashing files path. Outputs in which state it is during the update and creates a log file at the Desktop folder.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Interface IUpdater</h2>
<p><code><a class="el" href="_i_updater_8cs.html">IUpdater.cs</a></code></p>
<p>Interface of the Updater tool. Has the main methods for the update.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Class STM32</h2>
<p><code><a class="el" href="_s_t_m32_8cs.html">STM32.cs</a></code></p>
<p>Handles the interaction and update of the STM32 microcontroller.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
Class NRF52</h2>
<p><code><a class="el" href="_n_r_f52_8cs.html">NRF52.cs</a></code></p>
<p>Handles the interaction and update of the Wireless device.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Class ATMEL</h2>
<p><code><a class="el" href="_a_t_m_e_l_8cs.html">ATMEL.cs</a></code></p>
<p>Handles the interaction and update of the Display device.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Interface ISerialConnection</h2>
<p><code><a class="el" href="_i_serial_connection_8cs.html">ISerialConnection.cs</a></code></p>
<p>Interface of the Serial Communication. Has the main methods for the Serial Communication between Ports.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Class SerialConnection</h2>
<p><code><a class="el" href="_serial_connection_8cs.html">SerialConnection.cs</a></code></p>
<p>Has several methods in order to deal with the Serial Communication between the user and the devices.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Class Logger</h2>
<p><code><a class="el" href="_logger_8cs.html">Logger.cs</a></code></p>
<p>Has several methods in order to log the program state, interactions and results during its operation.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Project Architecture</h2>
<p><img src="UpdateTool-SequenceDiagram.png" alt="" class="inline" title="Diagram"/></p>
<h2><a class="anchor" id="autotoc_md19"></a>
Tests</h2>
<p><code><a class="el" href="_serial_connection_system_test_8cs.html">SerialConnectionSystemTest.cs</a></code></p>
<p>Test the serial communication components.</p>
<p><code><a class="el" href="_update_controller_test_8cs.html">UpdateControllerTest.cs</a></code></p>
<p>Integration Tests that test methods for the update of the devices. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
